@model IEnumerable<SiparisApi.Models.OrderListVm>



<!-- --------------------------------------------- -->
<!--          GRUPLANMIŞ + COLLAPSE SİPARİŞLER     -->
<!-- --------------------------------------------- -->
@foreach (var order in Model)
{
    string collapseId = $"order{order.Id}";
    var statusKey = order.Status?.Trim().ToLowerInvariant().Replace(" ", "");
    var icon = statusKey switch
    {
        "yeni" => "fas fa-star",
        "onaybekleniyor" => "fas fa-clock",
        "onaylandı" => "fas fa-check-circle",
        "üretimde" => "fas fa-industry",
        "iptal" => "fas fa-times-circle",
        _ => "fas fa-question-circle"
    };

    <div class="order-block">

        <!-- HEADER -->
        <div class="order-header" data-bs-toggle="collapse" data-bs-target="#@collapseId">
            <div class="header-left">
                <div class="header-title">
                    @order.CustomerName
                    <div class="customer-details">
                        <div class="hederse">

                            @if (!string.IsNullOrWhiteSpace(order.Adress))
                            {
                                <span><i class="fas fa-home"></i> @order.Adress</span>
                            }

                            @if (!string.IsNullOrWhiteSpace(order.City) || !string.IsNullOrWhiteSpace(order.Country))
                            {
                                <span><i class="fas fa-map-marker-alt"></i> @order.City @((order.City != null && order.Country != null) ? "/" : "") @order.Country</span>
                            }

                            @if (!string.IsNullOrWhiteSpace(order.Phone))
                            {
                                <span><i class="fas fa-phone"></i> @order.Phone</span>
                            }

                            @if (!string.IsNullOrWhiteSpace(order.Taxat))
                            {
                                <span><i class="fas fa-building"></i> @order.Taxat</span>
                            }
                        </div>
                    </div>

                </div>
         
            </div>

            
        </div>

        <!-- COLLAPSE BODY -->
        <div class="collapse order-items" id="@collapseId">

            <table class="items-table table table-bordered mb-0">
                <thead>
                    <tr>
                        <th>Ürün</th>
                        <th>Miktar</th>
                        <th>Net KG</th>
                        <th>Tutar</th>
                        <th>Temsilci</th>
                        <th>Durum</th>               
                                            
                        <th>İşlem</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in order.Items)
                    {
                        var total = item.Price * item.NetWeight;

                        <tr>
                            <td>@item.ProductName</td>

                            <td class="num-col">
                                @item.Quantity
                                <span class="order-unit">@item.PackingInfo</span>
                            </td>

                            <td class="num-col">
                                @item.NetWeight.ToString("N2") <span class="order-unit">Kg</span>
                            </td>

                            <td class="num-col order-amount-line">
                                @total.ToString("N2") <span class="order-unit">@order.Currency</span>
                            </td>
                                                     
                            <td>@order.SalesRepName</td>
                            <td>
                            <span class="order-status status-@statusKey">
                                <i class="@icon"></i> @order.Status
                            </span>
                            </td>
                            <td>
                                <a class="btn btn-primary btn-square"
                                   href="@Url.Action("Edit", "OrdersUIList", new { id = order.Id })">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <!-- DETAY SATIRI -->
            <div class="order-detail">
                <span><b>ID:</b> @order.Id</span>
                <b>Şehir/Ülke:</b> @order.PlaceOfDelivery &nbsp; | &nbsp;
                <b>Port:</b> @order.PortOfDelivery &nbsp; | &nbsp;
                <b>Ödeme Şartı:</b> @order.PaymentTerm &nbsp; | &nbsp;
                <b>Transport:</b> @order.Transport &nbsp; | &nbsp;
                <b>Açıklama:</b> @order.Items.FirstOrDefault()?.Description
            </div>

        </div>
    </div>
}
