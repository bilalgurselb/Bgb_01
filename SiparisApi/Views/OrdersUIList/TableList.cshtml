@model IEnumerable<SiparisApi.Models.OrderHeader>
@using System.Security.Claims
@{
    ViewData["Title"] = "Sipariş Listesi";
    Layout = "_Layout"; 
    var userRole = User.FindFirst("role")?.Value ?? "User";
    var userEmail = User.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value;
}

@if (ViewBag.EmptyMessage != null)
{
    <!-- 📱 Mobil uyumlu ortalanmış boş liste ekranı -->
    <div class="d-flex justify-content-center align-items-center text-center" style="height:70vh;">
        <div>
            <i class="fas fa-box-open fa-4x text-muted mb-3"></i>
            <h4 class="fw-normal text-secondary">@ViewBag.EmptyMessage</h4>

            <div class="mt-4">
                <a asp-controller="OrdersUIList" asp-action="Create" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Yeni Sipariş Oluştur
                </a>
            </div>
        </div>
    </div>
}
else{<!-- 🧾 Sadece sipariş varsa tabloyu göster -->
    <div class="container mt-4">
        <h3 class="mb-3 text-center">📦 Sipariş Listesi</h3>
        <div class="table-responsive shadow-sm">
            <table class="table table-hover align-middle">
                <thead class="table-light">
                    <tr>
                        <th>ID</th>
                        <th>Müşteri</th>
                        <th>Durum</th>
                        <th>Oluşturan</th>
                        <th>Oluşturulma</th>
                        <th>Güncelleme</th>
                        <th>Fiyat</th>
                        <th>İşlem</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var order in Model)
                    {
                        <tr>
                            <td>@order.Id</td>
                            <td>@order.CustomerId</td>
                            <td>
                                <span class="badge rounded-pill" style="background-color:@order.StatusColor;">@order.Status</span>
                            </td>
                            <td>@order.CreatedBy?.AllowedEmail?.NameSurname</td>
                            <td>@order.CreatedAt.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                            <td>@order.UpdatedAt?.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                            <td>@order.Items?.Sum(i => i.Price * i.Quantity).ToString("C2")</td>
                            <td>
                                <a asp-controller="OrdersUIList" asp-action="Edit" asp-route-id="@order.Id" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-edit"></i>
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
}
   

@section Styles {
    <style>
        .new-order {
            background-color: #fff9d6 !important;
            transition: background-color 1s ease;
        }

        .updated-order {
            background-color: #e6f7ff !important;
            transition: background-color 1s ease;
        }

        table {
            border-radius: 8px;
            overflow: hidden;
        }

        th {
            background-color: #f8f9fa;
        }
    </style>
}
