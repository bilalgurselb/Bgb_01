@model IEnumerable<SiparisApi.Models.OrderListVm>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    var userAgent = Context.Request.Headers["User-Agent"].ToString();
    var isMobile = userAgent.Contains("Mobi")
                || userAgent.Contains("Android")
                || userAgent.Contains("iPhone");
}
@functions {
    public static string GetCurrencyIcon(string currency)
    {
        return currency?.ToUpperInvariant() switch
        {
            "EUR" => "<i class='fas fa-euro-sign'></i>",
            "USD" => "<i class='fas fa-dollar-sign'></i>",
            "RUB" => "<i class='fas fa-ruble-sign'></i>",
            "TRY" => "<i class='fas fa-lira-sign'></i>",
            _ => $"<span>{currency}</span>"
        };
    }
}


@if (Model == null || !Model.Any())
{
    <div class="d-flex justify-content-center align-items-center text-center" style="height:60vh;">
        <div>
            <i class="fas fa-box-open fa-4x text-muted mb-3"></i>
            <h5 class="text-secondary">Kayıtlı sipariş bulunmamaktadır.</h5>

            <a href="@Url.Action("Create", "OrdersUIList")"
               class="btn btn-primary mt-3">
                <i class="fas fa-plus"></i> Yeni Sipariş
            </a>
        </div>
    </div>
}
else
{     
    var totalCount = Model.Count();
    var totalNetKg = Model.Sum(o => o.Items.Sum(i => i.NetWeight));

    var currencyGroups = new List<dynamic>();

    if (Model.Any())
    {
        currencyGroups = Model
            .GroupBy(o => o.Currency ?? "EUR")
            .Select(g => new
            {
                Currency = g.Key,
                TotalAmount = g.Sum(o => o.Items.Sum(i => i.Total))
            })
            .Cast<dynamic>()
            .ToList();
    }

    <div class="summary-item mb-3">
        <div class="d-flex justify-content-between align-items-center">
            <div class="summary-product-name">
                <i class="fas fa-clipboard-list"></i> Sipariş Özeti
            </div>
            <div class="badge bg-secondary text-white">@DateTime.Now.ToString("dd.MM.yyyy")</div>
        </div>

        <div class="summary-details mt-2">
            <div class="d-flex justify-content-between">
                <div><b>Toplam Sipariş:</b> @totalCount adet</div>
                <div><b>Toplam Net KG:</b> @totalNetKg.ToString("N2")</div>
            </div>

            <div class="mt-2 d-flex flex-wrap gap-3 align-items-center">
                @foreach (var grp in currencyGroups)
                {
                    <div class="currency-total">
                        @grp.TotalAmount.ToString("N2")
                        <span class="currency-icon">@Html.Raw(GetCurrencyIcon(grp.Currency))</span>
                    </div>
                }
            </div>
        </div>
    </div>




    if (isMobile)
    {
        @Html.Partial("_OrderCardsMobile", Model)
    }
    else
    {
        @Html.Partial("_OrderTableDesktop", Model)
    }
}
